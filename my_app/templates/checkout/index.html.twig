{% extends 'base.html.twig' %}
{% block title %}Checkout{% endblock %}

{% block body %}
  {% embed 'partials/_page_layout.html.twig' with {
    title: 'Checkout',
    subtitle: 'Select delivery address and confirm your order.',
    breadcrumbItems: [
      {'label': 'Cart', 'url': path('app_cart_index')},
      {'label': 'Checkout', 'url': path('app_checkout')}
    ]
  } %}
    {% block content %}
      <form action="{{ path('app_checkout_confirm') }}" method="POST">
        <div class="row">
          <!-- Address Selection -->
          <div class="col-md-6">
            <h5 class="fw-bold mb-3">Select Address</h5>
            {% if user.addresses is not empty %}
              {% for address in user.addresses %}
                <div class="form-check mb-2">
                  <input class="form-check-input" type="radio" name="address" value="{{ address.id }}" id="address{{ address.id }}" {% if loop.first %}checked{% endif %}>
                  <label class="form-check-label" for="address{{ address.id }}">
                    <strong>{{ address.type|capitalize }}</strong>: {{ address.street }}, {{ address.city }} ({{ address.country }})
                  </label>
                </div>
              {% endfor %}
            {% else %}
              <p class="text-muted">No addresses found. Please add one first.</p>
              <a href="{{ path('app_address_new') }}" class="btn btn-outline-primary btn-sm">Add Address</a>
            {% endif %}
          </div>

          <!-- Order Summary -->
          <div class="col-md-6">
            <h5 class="fw-bold mb-3">Order Summary</h5>
            <ul class="list-group mb-3">
              {% for item in cartItems %}
                <li class="list-group-item d-flex justify-content-between align-items-center">
                  {{ item.product.name }} × {{ item.quantity }}
                  <span>{{ item.subtotal|number_format(2) }} ₺</span>
                </li>
              {% endfor %}
              <li class="list-group-item d-flex justify-content-between fw-bold">
                Total <span>{{ total|number_format(2) }} ₺</span>
              </li>
            </ul>
            <button class="btn btn-success btn-lg w-100 mt-3">Confirm Order</button>
          </div>
        </div>
      </form>
    {% endblock %}
  {% endembed %}
{% endblock %}
